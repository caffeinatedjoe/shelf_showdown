<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shelf Showdown</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <div id="app" role="application" aria-label="Shelf Showdown Book Ranking App">
        <!-- Header with Logo -->
        <header id="app-header">
            <h1 id="app-title">Shelf Showdown</h1>
        </header>

        <!-- Tab Navigation -->
        <nav id="tab-nav" role="navigation" aria-label="Main navigation">
            <button id="tab-compare" class="tab-btn active" aria-label="Compare books">Compare</button>
            <button id="tab-rankings" class="tab-btn" aria-label="View rankings">Rankings</button>
            <button id="tab-add-book" class="tab-btn" aria-label="Add a new book">Add Book</button>
            <button id="tab-settings" class="tab-btn" aria-label="Settings and options">Settings</button>
        </nav>

        <!-- Main Content Area -->
        <main id="main-content">

            <!-- Setup Screen (First-time users) -->
            <section id="setup-view" class="view" role="main" aria-labelledby="setup-title" style="display: none;">
                <div id="setup-content">
                    <h1 id="setup-title">Welcome to Shelf Showdown</h1>
                    <p>Connect your Google Sheet to import your book list and start ranking your favorite reads.</p>
                    <button id="connect-google-btn" class="primary-btn" aria-label="Connect with Google">Connect with Google</button>
                    <div id="setup-status" aria-live="polite"></div>
                </div>
            </section>

            <!-- Compare Tab (Main Interface) -->
            <section id="compare-view" class="view active" role="main" aria-labelledby="compare-title">
                <div id="comparison-container">
                    <div id="book-a" class="book-card" aria-label="First book in comparison"></div>
                    <div id="vs-indicator" aria-label="versus">VS</div>
                    <div id="book-b" class="book-card" aria-label="Second book in comparison"></div>
                </div>
                <div id="comparison-actions">
                    <button id="skip-comparison-btn" class="text-btn" aria-label="Skip this comparison">Skip</button>
                    <button id="undo-comparison-btn" class="text-btn" aria-label="Undo last comparison">Undo</button>
                </div>
                <div id="comparison-progress" aria-live="polite">
                    <div id="progress-bar"></div>
                    <span id="progress-text">Keep going!</span>
                </div>
            </section>

            <!-- Rankings Tab -->
            <section id="rankings-view" class="view" role="main" aria-labelledby="rankings-title" style="display: none;">
                <h1 id="rankings-title">Your Rankings</h1>
                <div id="rankings-controls">
                    <select id="sort-options" aria-label="Sort rankings by">
                        <option value="rank">By Rank</option>
                        <option value="title">By Title</option>
                        <option value="author">By Author</option>
                        <option value="score">By Score</option>
                        <option value="reads">By Times Read</option>
                    </select>
                    <button id="export-ranking-btn" class="secondary-btn" aria-label="Export ranking">Export</button>
                </div>
                <div id="rankings-list" aria-label="Ranked list of books" role="list"></div>
            </section>

            <!-- Add Book Tab -->
            <section id="add-book-view" class="view" role="main" aria-labelledby="add-book-title" style="display: none;">
                <h1 id="add-book-title">Add New Book</h1>
                <form id="add-book-form">
                    <div class="form-group">
                        <label for="book-title">Title *</label>
                        <input type="text" id="book-title" required aria-describedby="title-help">
                        <span id="title-help" class="sr-only">Enter the book title</span>
                    </div>
                    <div class="form-group">
                        <label for="book-author">Author *</label>
                        <input type="text" id="book-author" required aria-describedby="author-help">
                        <span id="author-help" class="sr-only">Enter the book author</span>
                    </div>
                    <div class="form-group">
                        <label for="book-genre">Genre</label>
                        <input type="text" id="book-genre" aria-describedby="genre-help">
                        <span id="genre-help" class="sr-only">Enter the book genre (optional)</span>
                    </div>
                    <div class="form-group">
                        <label for="book-reads">Times Read</label>
                        <input type="number" id="book-reads" min="0" aria-describedby="reads-help">
                        <span id="reads-help" class="sr-only">Enter how many times you've read this book</span>
                    </div>
                    <div class="form-group">
                        <label for="book-date-read">Date Read</label>
                        <input type="date" id="book-date-read" aria-describedby="date-help">
                        <span id="date-help" class="sr-only">Enter the date you last read this book</span>
                    </div>
                    <div id="add-book-buttons">
                        <button type="submit" class="primary-btn" aria-label="Save new book">Save Book</button>
                        <button type="button" id="cancel-add-book" class="secondary-btn" aria-label="Cancel adding book">Cancel</button>
                    </div>
                </form>
                <div id="add-book-status" aria-live="polite"></div>
            </section>

            <!-- Settings Tab -->
            <section id="settings-view" class="view" role="main" aria-labelledby="settings-title" style="display: none;">
                <h1 id="settings-title">Settings</h1>
                <div id="settings-content">
                    <div class="settings-section">
                        <h2>Account</h2>
                        <button id="reconnect-google-btn" class="secondary-btn" aria-label="Reconnect Google account">Reconnect Google Sheets</button>
                        <button id="logout-btn" class="danger-btn" aria-label="Logout">Logout</button>
                    </div>
                    <div class="settings-section">
                        <h2>Data Management</h2>
                        <p>Warning: This will permanently delete all your books and rankings.</p>
                        <button id="purge-database-btn" class="danger-btn" aria-label="Purge all data">Purge Database</button>
                    </div>
                </div>
                <div id="settings-status" aria-live="polite"></div>
            </section>

        </main>

        <!-- Debug Section (hidden by default) -->
        <div id="debug-section" style="display: none; margin-top: 40px; border-top: 2px solid #ccc; padding-top: 20px;" aria-labelledby="debug-title">
            <h2 id="debug-title">üß™ Debug Zone - Test All Features</h2>

            <div style="margin-bottom: 20px;">
                <h3>üéØ Elo Algorithm Tests</h3>
                <button id="run-elo-tests-btn" class="neumorphic-btn" aria-label="Run Elo algorithm tests">Run Elo Tests</button>
                <button id="run-simulation-btn" class="neumorphic-btn" aria-label="Run ranking simulation">Run Ranking Simulation</button>
                <button id="run-benchmark-btn" class="neumorphic-btn" aria-label="Run performance benchmark">Run Performance Benchmark</button>
                <button id="check-integrity-btn" class="neumorphic-btn" aria-label="Check data integrity">Check Data Integrity</button>
                <button id="init-ratings-btn" class="neumorphic-btn" aria-label="Initialize book ratings">Initialize Book Ratings</button>
            </div>

            <div style="margin-bottom: 20px;">
                <h3>‚öñÔ∏è Comparison System Tests</h3>
                <button id="create-test-comparison-btn" class="neumorphic-btn" aria-label="Create test comparison">Create Test Comparison</button>
                <button id="process-comparisons-btn" class="neumorphic-btn" aria-label="Process comparisons">Process Comparisons & Update Ratings</button>
                <button id="view-comparison-history-btn" class="neumorphic-btn" aria-label="View comparison history">View Comparison History</button>
                <button id="get-comparison-stats-btn" class="neumorphic-btn" aria-label="Get comparison statistics">Get Comparison Stats</button>
            </div>

            <div style="margin-bottom: 20px;">
                <h3>üèÜ Ranking System Tests</h3>
                <button id="debug-calculate-ranking-btn" class="neumorphic-btn" aria-label="Calculate ranking">Calculate & Store Ranking</button>
                <button id="view-latest-ranking-btn" class="neumorphic-btn" aria-label="View latest ranking">View Latest Ranking</button>
                <button id="view-ranking-history-btn" class="neumorphic-btn" aria-label="View ranking history">View Ranking History</button>
            </div>

            <div style="margin-bottom: 20px;">
                <h3>üìä Google Sheets Sync Tests</h3>
                <button id="export-spreadsheet-btn" class="neumorphic-btn" aria-label="Export spreadsheet data">Export Spreadsheet Data</button>
                <button id="sync-to-sheets-btn" class="neumorphic-btn" aria-label="Sync to sheets">Sync Changes to Google Sheets</button>
                <button id="force-sync-to-sheets-btn" class="neumorphic-btn" aria-label="Force sync to sheets">Force Sync All to Google Sheets</button>
                <button id="view-sync-status-btn" class="neumorphic-btn" aria-label="View sync status">View Sync Status</button>
                <button id="process-sync-queue-btn" class="neumorphic-btn" aria-label="Process sync queue">Process Sync Queue</button>
            </div>

            <div style="margin-bottom: 20px;">
                <button id="clear-debug-btn" class="neumorphic-btn" aria-label="Clear debug output">Clear Debug Output</button>
            </div>

            <div id="debug-status" aria-live="polite"></div>
            <div id="debug-output" style="margin-top: 20px; white-space: pre-wrap; font-family: monospace; background: #f8f9fa; padding: 15px; border: 1px solid #dee2e6; border-radius: 5px; max-height: 600px; overflow-y: auto;" aria-label="Debug output"></div>
        </div>
    </div>
    <script type="module" src="app.js"></script>
</body>
</html>